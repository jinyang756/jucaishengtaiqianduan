<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>用户信息 - 绿色生态基金管理系统</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/src/assets/main.css">
  </head>
  <body class="bg-neutral-100 text-neutral-800 min-h-screen flex flex-col">
    <!-- 导航栏 -->
    <header class="bg-white shadow-md z-30">
      <div class="container mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center space-x-2">
          <i class="fa fa-leaf text-2xl text-primary"></i>
          <h1 class="text-xl font-bold text-neutral-900">绿色生态基金管理系统</h1>
        </div>
        <div class="hidden md:flex items-center space-x-6">
          <div class="relative">
            <input type="text" placeholder="搜索..." class="pl-9 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all-300">
            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-neutral-700"></i>
          </div>
          <div class="flex items-center space-x-4">
            <button class="relative p-2 text-neutral-700 hover:text-primary transition-all-300">
              <i class="fa fa-bell text-xl"></i>
              <span class="absolute top-0 right-0 h-2 w-2 bg-danger rounded-full"></span>
            </button>
            <div class="header-user-info relative flex items-center space-x-2 cursor-pointer hover-lift">
              <div class="header-user-avatar w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center">
                <i class="fa fa-user"></i>
              </div>
              <span class="header-user-name font-medium">管理员</span>
              <i class="fa fa-angle-down text-neutral-700"></i>
              
              <!-- 用户下拉菜单 -->
              <div class="user-dropdown-menu hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-1 z-40">
                <a href="#profile" class="block px-4 py-2 text-neutral-800 hover:bg-primary/10 hover:text-primary transition-colors">
                  <i class="fa fa-user-o mr-2"></i>个人资料
                </a>
                <a href="#settings" class="block px-4 py-2 text-neutral-800 hover:bg-primary/10 hover:text-primary transition-colors">
                  <i class="fa fa-cog mr-2"></i>账户设置
                </a>
                <a href="#change-password" class="change-password-btn block px-4 py-2 text-neutral-800 hover:bg-primary/10 hover:text-primary transition-colors">
                  <i class="fa fa-lock mr-2"></i>修改密码
                </a>
                <div class="border-t border-gray-200 my-1"></div>
                <a href="#logout" class="logout-btn block px-4 py-2 text-danger hover:bg-danger/10 transition-colors">
                  <i class="fa fa-sign-out mr-2"></i>注销登录
                </a>
              </div>
            </div>
          </div>
        </div>
        <button class="md:hidden text-neutral-800">
          <i class="fa fa-bars text-xl"></i>
        </button>
      </div>
    </header>

    <!-- 主内容区 -->
    <main class="flex-1 flex">
      <!-- 侧边栏 -->
      <aside id="sidebar" class="w-64 bg-white shadow-md fixed h-[calc(100vh-64px)] left-0 top-[64px] transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out z-20 overflow-y-auto">
        <nav class="py-4">
          <ul class="space-y-1">
            <li>
              <a href="/index.html" class="flex items-center space-x-3 px-6 py-3 text-neutral-800 hover:bg-neutral-100 rounded-r-full transition-all-300">
                <i class="fa fa-tachometer text-lg w-6 text-center"></i>
                <span>仪表板</span>
              </a>
            </li>
            <li>
              <a href="/fund-management.html" class="flex items-center space-x-3 px-6 py-3 text-neutral-800 hover:bg-neutral-100 rounded-r-full transition-all-300">
                <i class="fa fa-line-chart text-lg w-6 text-center"></i>
                <span>基金管理</span>
              </a>
            </li>
            <li>
              <a href="/investment-analysis.html" class="flex items-center space-x-3 px-6 py-3 text-neutral-800 hover:bg-neutral-100 rounded-r-full transition-all-300">
                <i class="fa fa-pie-chart text-lg w-6 text-center"></i>
                <span>投资分析</span>
              </a>
            </li>
            <li>
              <a href="/transaction-history.html" class="flex items-center space-x-3 px-6 py-3 text-neutral-800 hover:bg-neutral-100 rounded-r-full transition-all-300">
                <i class="fa fa-exchange text-lg w-6 text-center"></i>
                <span>交易历史</span>
              </a>
            </li>
            <li>
              <a href="/user-profile.html" class="flex items-center space-x-3 px-6 py-3 text-primary bg-primary/10 rounded-r-full font-medium">
                <i class="fa fa-user text-lg w-6 text-center"></i>
                <span>个人资料</span>
              </a>
            </li>
            <li>
              <a href="/system-settings.html" class="flex items-center space-x-3 px-6 py-3 text-neutral-800 hover:bg-neutral-100 rounded-r-full transition-all-300">
                <i class="fa fa-cog text-lg w-6 text-center"></i>
                <span>系统设置</span>
              </a>
            </li>
          </ul>
        </nav>
      </aside>

      <!-- 内容区域 -->
      <div class="flex-1 md:ml-64 p-6">
        <div class="container mx-auto">
          <div class="mb-6">
            <h2 class="text-2xl font-bold text-neutral-900">个人资料</h2>
            <p class="text-neutral-700">查看和管理您的个人信息</p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- 用户基本信息卡片 -->
            <div class="bg-white rounded-xl shadow-md p-6 md:col-span-1">
              <div class="flex flex-col items-center">
                <div class="user-avatar w-24 h-24 rounded-full bg-primary text-white flex items-center justify-center text-3xl mb-4">
                  <span id="user-initials">A</span>
                </div>
                <h3 class="text-xl font-bold text-neutral-900" id="user-name">管理员</h3>
                <p class="text-neutral-700 mb-4" id="user-email">admin@example.com</p>
                <div class="text-sm text-primary mb-6" id="user-role">系统管理员</div>
                <button class="w-full py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors flex items-center justify-center space-x-2">
                  <i class="fa fa-camera"></i>
                  <span>更换头像</span>
                </button>
              </div>
              
              <div class="mt-6 space-y-3">
                <div class="flex items-start space-x-3">
                  <i class="fa fa-id-card text-primary mt-1"></i>
                  <div>
                    <p class="font-medium text-neutral-900">用户ID</p>
                    <p class="text-neutral-700" id="user-id">USER123456</p>
                  </div>
                </div>
                <div class="flex items-start space-x-3">
                  <i class="fa fa-calendar-check-o text-primary mt-1"></i>
                  <div>
                    <p class="font-medium text-neutral-900">注册日期</p>
                    <p class="text-neutral-700" id="user-join-date">2023-01-15</p>
                  </div>
                </div>
                <div class="flex items-start space-x-3">
                  <i class="fa fa-clock-o text-primary mt-1"></i>
                  <div>
                    <p class="font-medium text-neutral-900">最后登录</p>
                    <p class="text-neutral-700" id="user-last-login">刚刚</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- 用户详细信息表单 -->
            <div class="bg-white rounded-xl shadow-md p-6 md:col-span-2">
              <h3 class="text-xl font-bold text-neutral-900 mb-6">账户信息</h3>
              
              <form id="user-info-form" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label for="full-name" class="block text-sm font-medium text-neutral-700 mb-2">姓名</label>
                    <input type="text" id="full-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all-300" value="管理员">
                  </div>
                  <div>
                    <label for="email" class="block text-sm font-medium text-neutral-700 mb-2">电子邮箱</label>
                    <input type="email" id="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all-300" value="admin@example.com">
                  </div>
                  <div>
                    <label for="phone" class="block text-sm font-medium text-neutral-700 mb-2">手机号码</label>
                    <input type="tel" id="phone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all-300" value="138****1234">
                  </div>
                  <div>
                    <label for="department" class="block text-sm font-medium text-neutral-700 mb-2">部门</label>
                    <input type="text" id="department" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all-300" value="管理部">
                  </div>
                </div>
                
                <div class="space-y-4">
                  <label for="bio" class="block text-sm font-medium text-neutral-700">个人简介</label>
                  <textarea id="bio" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all-300">系统管理员，负责平台的日常维护和管理工作。</textarea>
                </div>
                
                <div class="pt-4 flex justify-end space-x-4">
                  <button type="button" class="px-6 py-2 border border-gray-300 text-neutral-700 rounded-lg hover:bg-neutral-100 transition-colors">
                    取消
                  </button>
                  <button type="submit" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors">
                    保存更改
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script type="module" src="/src/main.js"></script>
    <script type="module">
      import authService from '/src/authService.js';
      import apiService from '/src/apiService.js';
      
      document.addEventListener('DOMContentLoaded', async () => {
        try {
          // 获取当前用户信息
          const user = await authService.getCurrentUser();
          if (user) {
            // 更新页面上的用户信息
            document.getElementById('user-name').textContent = user.name || '管理员';
            document.getElementById('user-email').textContent = user.email || 'admin@example.com';
            document.getElementById('user-role').textContent = user.role || '系统管理员';
            document.getElementById('user-id').textContent = user.id || 'USER' + Math.floor(Math.random() * 1000000);
            document.getElementById('user-join-date').textContent = user.createdAt || '2023-01-15';
            document.getElementById('user-last-login').textContent = user.lastLogin || '刚刚';
            document.getElementById('user-initials').textContent = user.name ? user.name.charAt(0).toUpperCase() : 'A';
            
            // 填充表单
            document.getElementById('full-name').value = user.name || '管理员';
            document.getElementById('email').value = user.email || 'admin@example.com';
            document.getElementById('phone').value = user.phone || '138****1234';
            document.getElementById('department').value = user.department || '管理部';
            document.getElementById('bio').value = user.bio || '系统管理员，负责平台的日常维护和管理工作。';
          }
        } catch (error) {
          console.error('获取用户信息失败:', error);
          alert('获取用户信息失败，请重新登录');
          window.location.href = '/login.html';
        }
        
        // 表单提交处理
        const userInfoForm = document.getElementById('user-info-form');
        if (userInfoForm) {
          userInfoForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            const formData = {
              name: document.getElementById('full-name').value,
              email: document.getElementById('email').value,
              phone: document.getElementById('phone').value,
              department: document.getElementById('department').value,
              bio: document.getElementById('bio').value
            };
            
            try {
              // 调用API更新用户信息
              await apiService.user.updateInfo(formData);
              
              alert('个人信息更新成功');
            } catch (error) {
              console.error('更新用户信息失败:', error);
              alert('更新用户信息失败，请稍后重试');
            }
          });
        }
      });
    </script>
  </body>
</html>